<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="../js/mui.min.js"></script>
    <script src="../js/flexible.js"></script>
    <link rel="stylesheet" href="../css/mui.min.css">
    <link rel="stylesheet" href="../css/iconfont.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/goodDetail.css">
    <title>Document</title>
</head>

<body>
    <div class="action-bar-no-search">
        <div class="title-left mui-action-back">
            <div>
                <span class="mui-icon mui-icon-back">

                </span>
                <span>

                </span>
            </div>
        </div>
        <div class="title-center">
            商品详情
        </div>
        <div class="title-right">
            <div class="title-right-left">
                <img src="" />
            </div>
            <div class="title-right-right">
                <img src="" alt="">
            </div>
        </div>
    </div>
    <div id="container" class="container" style="background-color: #F7F5F4;">
        <div class="mui-scroll-wrapper">
            <div class="mui-scroll">
                <div class="mui-slider">
                    <div class="mui-slider-group">
                        <div class="mui-slider-item" v-for="img in goodMessage.goods_images">
                            <a href="#">
                                <img v-bind:src="http_url+img.pic" />
                            </a>
                        </div>
                    </div>
                    <div class="mui-slider-indicator">
                        <div class="mui-indicator mui-active"></div>
                        <div class="mui-indicator"></div>
                        <div class="mui-indicator"></div>
                        <div class="mui-indicator"></div>
                    </div>
                </div>
                <div class="good-message">
                    <div class="good-name-price">
                        <div class="top">
                            <div class="left">
                                <div>{{goodMessage.goods_name}}
                                </div>
                                <p>
                                    <span>￥</span>{{goodMessage.market_price}}</p>
                            </div>
                            <!-- <div class="right" @tap="share()">
                            <div>
                                <img src="../img/share.png" alt="">
                            </div>
                            分享
                        </div> -->
                        </div>
                        <div class="bottom">
                            <div class="freight">
                                <div class="left">
                                    运费：
                                    <span>10.00</span>
                                </div>
                                <div class="center">
                                    月销
                                    <strong>5824</strong>笔
                                </div>
                                <div class="right">
                                    太原晋源
                                </div>
                            </div>
                            <div class="true-yellow">
                                <div>
                                    <img src="../img/true-yellow.png" alt=""> 正品保障
                                </div>
                                <div>
                                    <img src="../img/true-yellow.png" alt=""> 急速退款
                                </div>
                                <div>
                                    <img src="../img/true-yellow.png" alt=""> 运费险
                                </div>
                                <div>
                                    <span class="mui-icon mui-icon-arrowright"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="list-message">
                    <div class="parpmeter" style="border-bottom: 1px solid #F7F5F4">
                        <span>
                            产品参数
                        </span>
                        <span class="mui-icon mui-icon-arrowright">

                        </span>
                    </div>
                    <div class="parpmeter">
                        <span>
                            适用车型
                        </span>
                        <span class="mui-icon mui-icon-arrowright">

                        </span>
                    </div>
                </div> -->
                </div>
                <!-- <div class="common">
                <div class="line">

                </div>
                <div class="message">
                    <span class="mui-icon mui-icon-chatbubble">

                    </span>
                    <span>
                        评价
                    </span>
                </div>
                <div class="line">

                </div>
            </div> -->
                <!-- <div class="good-assess">
                <div class="padding">
                    <p>宝贝评价 (
                        <span>3247</span>)</p>
                    <div class="clearfloat" @tap="getHttp()">
                        <div class="assess-button">
                            质量很好 (
                            <span>85</span>)
                        </div>
                        <div class="assess-button">
                            质量很好 (
                            <span>85</span>)
                        </div>
                        <div class="assess-button">
                            质量很好 (
                            <span>85</span>)
                        </div>
                        <div class="assess-button">
                            质量很好 (
                            <span>85</span>)
                        </div>
                        <div class="assess-button">
                            质量很好 (
                            <span>85</span>)
                        </div>
                    </div>
                    <div class="video-message clearfloat">
                        已评价43526次
                        <div class="video-comment-love-it float-right">
                            <img src="../img/comment.png" alt=""> 点击评论
                        </div>
                        <div class="video-comment-love-it float-right">
                            <img src="../img/love-it.png" alt=""> 点赞
                        </div>
                    </div>
                </div>
            </div> -->
                <div class="common">
                    <div class="line">

                    </div>
                    <div class="message">
                        <span class="mui-icon mui-icon-chatbubble">

                        </span>
                        <span>
                            详情
                        </span>
                    </div>
                    <div class="line">

                    </div>
                </div>
                <div class="good-name">
                    {{goodMessage.goods_remark}}
                </div>
                <div class="good-text">
                    <div class="good">
                        商品信息
                    </div>
                </div>
                <div>
                    <!-- <div class="good-message-list-every-last">
                    <div class="good-message-list-every-last-left">
                        包装价格
                    </div>
                    <div class="good-message-list-every-last-right">
                        4支装
                    </div>
                </div>
                <div class="good-message-list-every-last">
                    <div class="good-message-list-every-last-left">
                        包装价格
                    </div>
                    <div class="good-message-list-every-last-right">
                        4支装
                    </div>
                </div>
                <div class="good-message-list-every-last">
                    <div class="good-message-list-every-last-left">
                        品牌
                    </div>
                    <div class="good-message-list-every-last-right">
                        Bosch/博世
                    </div>
                </div>
                <div class="good-message-list-every-last">
                    <div class="good-message-list-every-last-left">
                        零配件分类
                    </div>
                    <div class="good-message-list-every-last-right">
                        汽车配件
                    </div>
                </div>
                <div class="good-message-list-every-last">
                    <div class="good-message-list-every-last-left">
                        火花塞类型
                    </div>
                    <div class="good-message-list-every-last-right">
                        电阻火花塞
                    </div>
                </div> -->
                </div>
                <div id="good-message-list">

                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="left">
                <div>
                    <p>
                        <span class="iconfont icon-kefu font"></span>
                    </p>
                    <p>
                        客服
                    </p>
                </div>
                <div @tap="collection($event)" id="collection">
                    <p>
                        <span class="iconfont icon-shoucang1 font"></span>
                    </p>
                    <p class="text">
                        收藏
                    </p>
                </div>
            </div>
            <div class="center">
                加入购物车
            </div>
            <div class="right">
                立刻购买
            </div>
            <!-- 弹出选择商品分类框 -->
            <div id="popup" class="popup">
                <div class="popup-top">
                    <div class="popup-img">
                        <img src="../img/good03.png" alt="">
                    </div>
                    <div class="popup-good-message">
                        <div class="popup-good-name">
                            {{goodMessage.goods_name}}
                        </div>
                        <div class="popup-price-specification">
                            <div class="popup-price">
                                ￥{{goodMessage.market_price}}
                            </div>
                            <div class="popup-specification">
                                请选择商品属性
                            </div>
                        </div>
                    </div>
                </div>
                <div class="scroll-wrapper">
                    <div class="mui-scroll">
                        <div class="popup-center">
                            <div class="good-attribute">
                                属性：
                            </div>
                            <div class="good-attribute-list">
                                <div class="good-attribute-list-every-last">
                                    FR8DPP30X（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR7HPP332W（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR5KPP332S（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR6HI332（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR8DPP30X（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR7HPP332W（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR5KPP332S（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR6HI332（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR8DPP30X（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR7HPP332W（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR5KPP332S（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR6HI332（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR8DPP30X（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR7HPP332W（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR5KPP332S（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR6HI332（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR8DPP30X（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR7HPP332W（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR5KPP332S（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR6HI332（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR8DPP30X（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR7HPP332W（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR5KPP332S（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR6HI332（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR8DPP30X（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR7HPP332W（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR5KPP332S（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR6HI332（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR8DPP30X（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR7HPP332W（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR5KPP332S（4支）
                                </div>
                                <div class="good-attribute-list-every-last">
                                    FR6HI332（4支）
                                </div>
                            </div>
                        </div>
                        <div class="buy-number">
                            <div class="buy-number-text">
                                购买数量
                            </div>
                            <div class="number">
                                <div class="add">
                                    <span class="mui-icon mui-icon-plusempty">

                                    </span>
                                </div>
                                <input value="1" class="buy-number-input" type="text">

                                <div class="remove">
                                    <span>
                                        －
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="popup-bottom">
                    <div class="add-shoppingcart">
                        加入购物车
                    </div>
                    <div class="buy">
                        立刻购买
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 遮罩层 -->
    <div id="mask">

    </div>
    <script src="../js/vue.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/common.js"></script>
    <script>
        var gallery = mui('.mui-slider');
        gallery.slider({
            interval: 2000//自动轮播周期，若为0则不自动播放，默认为0；
        });
        mui.ajax(http_url + "/api.php/Salecar/car_brand", {

        })
        var vm = new Vue({
            el: "#container",
            data: {
                goodMessage: {},
                goodData: {}
            },
            methods: {
                resetData: function () {//重置数据
                    Object.assign(this.$data, goodMessage);
                }
            }
        })
        //在details页面接收id参数
        var firstImage;                                                             //轮播图的第一张图片
        var lastImage;                                                              //轮播图的最后一张图片
        window.addEventListener('goodId', function (event) {
            //获得事件参数
            var id = event.detail.id;
            mui.ajax(http_url + '/api.php/Mall/details?id=' + id, {
                dataType: 'json',
                type: 'get',
                timeout: 10000,
                headers: { 'Content-Type': 'application/json' },
                success: function (data) {
                    vm.goodMessage = data.data.info;
                    firstImage = data.data.info.goods_images[0];
                    lastImage = data.data.info.goods_images.pop();
                    vm.goodData = data.data;
                    if (data.data.addFav == 1) {
                        console.log("?????")
                        collection_good.querySelector(".text").innerText = "已收藏";
                        collection_good.querySelectorAll("p")[0].style.color = "red";
                        collection_good.querySelectorAll("p")[1].style.color = "red";
                    } else {
                        collection_good.querySelector(".text").innerText = "收藏";
                        collection_good.querySelectorAll("p")[0].style.color = "#666";
                        collection_good.querySelectorAll("p")[1].style.color = "#666";
                    }
                    document.getElementById("good-message-list").innerHTML = vm.goodMessage.goods_content;
                    console.log(vm.goodMessage);
                },
                error: function (xhr, type, errorThrown) {
                    //异常处理；ss
                    console.log(errorThrown);
                }
            });
            console.log(http_url + '/Mall/details?id=' + id);

        });

        function getHttp() {
            console.log(document.querySelector(".whd").src);
        }

        mui.plusReady(function () {
            // plus.share.getServices(function (s) {
            //     shares = s;
            // }, function (e) {
            //     alert("获取分享服务列表失败：" + e.message);
            // });
        })
        // 分享
        // function share() {
        //     plus.share.getServices(function (s) {
        //         shares = ss;
        //         for (var i in ss) {
        //             var s = ss[i];
        //             var item = document.createElement("li");
        //             item.setAttribute("class", "ditem");
        //             item.setAttribute("onclick", (s.id == "weixin") ? "shareWeiXin(this.plusShare)" : "shareAction(this.plusShare)");
        //             item.innerText = s.description;
        //             item.plusShare = s;
        //             list.appendChild(item);
        //         }
        //     }, function (e) {
        //         alert("获取分享服务列表失败：" + e.message);
        //     });
        // }
        //初始化input value值;
        var collection_good = document.getElementById("collection");
        var number = 1;         //购买数量
        var inputDom = document.querySelector(".popup").getElementsByClassName("buy-number-input")[0];
        inputDom.value = number;
        var popup = document.getElementById("popup");
        var mask = document.getElementById("mask");
        // 购买数量添加
        mui(".popup").on("tap", ".add", function () {
            number++;
            inputDom.value = number;
        })
        //购买数量减少
        mui(".popup").on("tap", ".remove", function () {
            if (number > 1) {
                number--;
                inputDom.value = number;
            }
        })

        //点击选择收藏商品
        function collection(e) {
            var eTarget = e.currentTarget;
            var id = vm.goodMessage.goods_id;
            var token = localStorage.getItem("token");
            if (!token) {
                toast("请登录");
                return;
            }
            if (e.currentTarget.querySelector(".text").innerText == "收藏") {
                mui.ajax(http_url + '/api.php/Mall/add_collect?id=' + id + '&token=' + token, {
                    dataType: 'json',
                    type: 'get',
                    timeout: 10000,
                    headers: { 'Content-Type': 'application/json' },
                    success: function (data) {
                        toast(data.message);
                        console.log(e.currentTarget);
                        eTarget.querySelector(".text").innerText = "已收藏";
                        eTarget.querySelectorAll("p")[0].style.color = "red";
                        eTarget.querySelectorAll("p")[1].style.color = "red";

                    },
                    error: function (xhr, type, errorThrown) {
                        //异常处理；ss
                        console.log(errorThrown);
                    }
                })
            } else {
                mui.ajax(http_url + '/api.php/Mall/del_collect?id=' + id + '&token=' + token, {
                    dataType: 'json',
                    type: 'get',
                    timeout: 10000,
                    headers: { 'Content-Type': 'application/json' },
                    success: function (data) {
                        toast(data.message);
                        eTarget.querySelector(".text").innerText = "收藏";
                        eTarget.querySelectorAll("p")[0].style.color = "#666";
                        eTarget.querySelectorAll("p")[1].style.color = "#666";
                    },
                    error: function (xhr, type, errorThrown) {
                        //异常处理；ss
                        console.log(errorThrown);
                    }
                })
            }


        }

        //选择商品属性
        var goodAttribute = document.getElementsByClassName("good-attribute-list-every-last");
        console.log(goodAttribute);
        var oldIndex = 0;
        goodAttribute[oldIndex].style.backgroundColor = "#f8c750";
        goodAttribute[oldIndex].style.color = "#ffffff";
        document.getElementsByClassName("popup-specification")[0].innerText = "已选：" + goodAttribute[oldIndex].innerText;
        for (var i = 0; i < goodAttribute.length; i++) {
            goodAttribute[i].index = i;
            goodAttribute[i].addEventListener("tap", function () {
                console.log(this.index);
                if (oldIndex != this.index) {
                    this.style.backgroundColor = "#f8c750";
                    this.style.color = "#ffffff";
                    goodAttribute[oldIndex].style.backgroundColor = "#e6e5e3";
                    document.getElementsByClassName("popup-specification")[0].innerText = "已选：" + this.innerText;
                    goodAttribute[oldIndex].style.color = "#666666";
                    oldIndex = this.index;
                }
            })
        }
        //跳转到结算页面
        var url;
        mui(".popup-bottom").on("tap", ".buy", function () {
            url = "paymentMessage.html"
            mui.openWindow({
                url: url,
                id: url
            })
        })
        mui('.mui-scroll-wrapper').scroll({
            deceleration: 0.0005,
            indicators: true
        });
        mui('.scroll-wrapper').scroll({
            deceleration: 0.0005,
            indicators: true
        });
        mui(".bottom-nav").on("tap", ".center", function () {
            popup.style.bottom = 0;
            mask.style.display = "block";
        })
        mui(".bottom-nav").on("tap", ".right", function () {
            popup.style.bottom = 0;
            mask.style.display = "block";
        })
        mask.addEventListener("tap", function () {
            popup.style.bottom = -14 + "rem";
            mask.style.display = "none";
        })
    </script>
</body>

</html>